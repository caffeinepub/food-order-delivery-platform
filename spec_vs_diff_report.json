{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-26T09:47:41.702Z",
  "summary": "The diff addresses all five requirements (REQ-33 through REQ-37). Backend main.mo uses a single canonical orders map. Frontend hooks add polling intervals and proper enablement guards. OrderConfirmation uses useOrderById with 8s polling. MyOrdersView uses useGetMyOrders with 15s polling. CourierApp uses useAllOrders with 15s polling. CustomerPortal persists orderId to sessionStorage. However, some specific acceptance criteria have gaps around query invalidation after mutations and explicit re-fetch on navigation.",
  "missing_requirements": [
    {
      "id": "REQ-34",
      "requirement": "On mount and on navigation to the Menu or Order Confirmation view, the portal must re-fetch the user's latest orders from the backend via getOrdersByCustomer.",
      "reason": "CustomerPortal.tsx persists confirmedOrderId to sessionStorage and renders the correct views, but no explicit effect or callback triggers a re-fetch of getOrdersByCustomer when navigating to the 'menu' or 'confirmation' view. Polling handles background refresh but no navigation-triggered refetch is visible in the diff.",
      "evidence": [
        "frontend/src/pages/CustomerPortal.tsx",
        "frontend/src/hooks/useQueries.ts"
      ]
    },
    {
      "id": "REQ-36",
      "requirement": "The useOrdersByCustomer query must be invalidated and refetch after a successful placeOrder or cancelOrder mutation.",
      "reason": "The diff content for useQueries.ts is truncated and does not confirm that onSuccess handlers for placeOrder or cancelOrder mutations invalidate the customer orders query key. The 15s polling is present but mutation-triggered invalidation is not confirmed.",
      "evidence": [
        "frontend/src/hooks/useQueries.ts"
      ]
    }
  ],
  "hallucinated_features": [],
  "confidence": 0.62,
  "changed_files": [
    "backend/main.mo",
    "frontend-file-summaries.txt",
    "frontend/src/components/MyOrdersView.tsx",
    "frontend/src/components/OrderCard.tsx",
    "frontend/src/components/OrderConfirmation.tsx",
    "frontend/src/hooks/useQueries.ts",
    "frontend/src/pages/CourierApp.tsx",
    "frontend/src/pages/CustomerPortal.tsx",
    "project_state.json"
  ]
}